---
title: ADR-004
id: adr-004
displayed_sidebar: resourcesSidebar
---

# ADR-004: Realtime Data Channels (WIP)

[![hackmd-github-sync-badge](https://hackmd.io/iomfscGXR1ycI_67NrLvMw/badge)](https://hackmd.io/iomfscGXR1ycI_67NrLvMw)

## Abstract

The fundamental communication component across all Sonr nodes is the `channel`. By utilizing data and transport agnostic realtime streams between nodes, we effectively have realtime structured data transmission at any point in the world.

## Primer

The Sonr channel implementation requires prior knowledge of the following definitions before implementation.

### `multiaddr` 

Multiaddr's are self describing addresses that operate on any network protocol. They provide human-readable and efficient machine-readable representations. [The multiaddr spec](https://github.com/multiformats/multiaddr) by protocol labs provides further details about the mechanism.

### `pub-sub`

The Sonr implementation follows the standard publish/subscribe model present with the modern web, with the caveat that it operates on a peer-to-peer node. In particular Sonr utilizes the [gossip-sub implementation specification](https://docs.libp2p.io/concepts/publish-subscribe/) to manage sending messages between peers on the network.

## Objective

- An Open transport agnostic communication mechanism
- Accessibility for users to listen to channels based on application
- A mechanism for developers to create channels for their individual development needs
- Structured Object reperesentation as the payload body between messages, as specified in [ADR-002](http://docs.sonr.io/articles/reference/adr-002)

## Addressing & Identifiying Topics

In Sonr the name of a channel follows the `multiaddr` specification for individual protocols that operate for a specific application. When resolving a `DIDDocument` of a particular application, developers are also provided a list of channels present for the application under its Service endpoint property.

### Topics 

Topics in the Sonr channel mechanism are defined as Developer created persistent stream endpoints where users can join and are always ensured to return pre-defined structured data, as per [ADR-002](http://docs.sonr.io/articles/reference/adr-002).

**Topic Name Representation**

`/sonr/[application-name]/[version]/[topicName]`

**Example Topic Identifier**

`/sonr/beam/v1/exampleGroupChat`

### Protocols

Protocols in the Sonr channel mechanism are defined as pre-packaged spec-compliant functionality, accessible to both users to interact and developers to leverage. For example one of the provided core protocols by the Sonr Team is our [Libp2p Matrix Integration](https://archive.fosdem.org/2020/schedule/event/dip_p2p_matrix/).

## Client Side Interaction

The following methods are provided by Sonr's client-side Motor package, to be leveraged by frontends powered by the Sonr ecosystem.

### `ListenChannel()`

```
(GET): /v1/channel/{topicName}
- topicName:string
```

When a channel has succesfully been routed and verified, the client is returned a `StreamHandler` that reads the incoming data from the given channel. The user is automatically disconnected from the channel when the `StreamHandler` is cancelled.

### `PublishChannel()`
```
(POST): /v1/channel/{topicName}
- topicName:string
- body:buffer
```

Calling a post method to the endpoint results in the client posting a message to the underlying `PubSub` topic. The message will successfully publish to the channel if the provided body message correctly maps to the `DID` and object reference involved with the channel.

## CRUD Methods 

### `CreateChannel`
```
(POST): /v1/channel/create
- Creator:string
- Label:string
- Description:string
- RegisteredObject:sonrio.sonr.object.ObjectDoc
```

This method is utilized to create a new Channel definition for an application powered by the Sonr network. The method requires the creator, label for human-readable representation, description for the functionality of the channel, and a registered object for defining what structured data is returned by the channel.

**Response**

```json
{
    type : "tx/MsgCreateChannel",
    body: {
        "code": 200,
        "did": "did:snr:abc123",
        "channel": {
            "label": "test",
            "description": "A example channel",
            "registeredObject": [...] // See ADR-002
        }
    }
}
```

### `UpdateChannel`
```
(POST): /v1/channel/update
- Creator:string
- Label:string
- Description:string
- RegisteredObject:sonrio.sonr.object.ObjectDoc
```

This method is utilized by a developer to update an existing configuration of a channel.

**Response**

```json
{
    type : "tx/MsgUpdateChannel",
    body: {
        "code": 200,
        "did": "did:snr:abc123",
        "channel": {
            "label": "test",
            "description": "A example channel",
            "registeredObject": [...] // See ADR-002
        }
    }
}
```

### `DeleteChannel`
```
(POST): /v1/channel/delete
- Creator:string
- Label:string
```

This method is utilized by developers to effectively eliminate any existing structured channel representation for a given application.


**Response**

```json
{
    type : "tx/MsgDeleteChannel",
    body: {
        "code": 200,
        "did": "did:snr:abc123",
    }
}
```

## Sequence Diagrams

WIP

---

### TO-DO
- [ ] Motor Interaction methods for `Channel`
- [ ] Developer CRUD methods for `x/channel`
- [ ] Protocol based topic identifiers for `x/channel`
- [ ] Remove `x/channel` and make the Genesis object for Channels a `List`

### References

- [Libp2p Pubsub](https://docs.libp2p.io/concepts/publish-subscribe/)
- [MultiAddr Specification](https://github.com/multiformats/multiaddr)
- [Sonr ADR-003](http://localhost:3000/articles/reference/adr-003)


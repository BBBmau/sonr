---
title: ADR-006 (WIP)
id: adr-006
displayed_sidebar: resourcesSidebar
---
# ADR 006: Deployable Functions (WIP)

## Introduction
Implent user defined functions invokable over http within Nodes.

## Abstract

The goal of user defined functions is to allow for custom defined behavior, defined by users which is accessible via `HTTP`. These functions will all be accessible over a single endpoint,  predefined within the highway.  When a request is sent to a static endpoint, containing the desired name of the invokable function, the function will be then invoked, with a single parameter, which will be a `WhatIs` allowing for desired content to be queried and interacted with.

## URL Schema

User Defined functions within the Highway will have a single entry point.

`/v1/functions/{name}/{did}/{cid}`

the above URL has two params

| Name | Type | Description |
| --- | --- | --- |
| name | string | Name of user defined function |
| cid | string | Content ID to be retrieved from file storage (object, blob) |
| did | string | Controller of function, used for scoping of user function |
## CLI Commands

The CLI will need a single root level command called `function`. function will have the following two sub commands
```
| Name | params | Description |
| --- | --- | --- |
| add | <name> <path-to-binary> | Adds a single function to a defined name  |
| remove | <name> | Removes user defined function from the function table |
```
## Storage of Functions Invokable over url

Once a function is associated with a name and provided to the highway, a function will then have the association of name → function. Each function will be a single relation to the user given function. Meaning a function can be resolved via its name `name` but a function cannot resolve its name, as the function is not explicitly required to have an associative name that matches its function name.

## Function Registry

We will need a new registry type for functions, the registry will associate a given function name to a Function Definition, the function registry will allow for an associative `WhoIs` to be generated for a given function. Creating a unique representation of the binary data.  The following represents a given user function in the registry

```go
type UserFunctionDefiniton struct {
	name string
	User string
	def UserFunction
}
```



# User functions

Each function is wrapper in a ‘Content provider’ which handles querying based on user specified CID the wrapper is thin as to be quick to resolve as possible in order to keep latency cost minimal. this is directly dependent on the GoLang IPFS implementation. If the query is successful it will then be passed to the user’s defined function. Said function is assumed to be precompiled into binary format. For invocation of the defined user function there are two paths that are currently known

- Interface implementation of predefined function definition which then can be invoked through GoLang’s reflection features.
- Binary is precompiled as an entry point which then can have its cid passed as an argument to the executable.

Currently the executable options is more appealing as it is easier to sandbox a plain binary into a ‘jail’ rather than implementing sandboxing around a reflection execution implementation. Below is a primitive definition for a user defined function.

```go
type UserFunction struct {
    did string // did from defintion
    file cid
    callbackURL string
    params []string
}
```

## Function Parameters

Parameters have mapped types by parameter name to decode parameters. Parameters should be uniform in type as strings. other types for parameters will not be supported.

## User Defined Callbacks
Content queried by **CID** cannot be modified by user defined functions, however, data can be redirected in the form of a callback URL statically defined by the user. Content will then be serialized to a string, and redirected to the callback. this can either be handled by the user in their own implementation as a mandated implementation requirment for functions, or we can request the data is returned by their function, and our own application layers handle routing the returned content to the URL.

### Data Sent to Callback


## Diagrams

[https://www.figma.com/file/v9E6Om23rm80JROFHVnr31/Highway-sdk-user-defined-functions-(non-faas)?node-id=0%3A1](https://www.figma.com/file/v9E6Om23rm80JROFHVnr31/Highway-sdk-user-defined-functions-(non-faas)?node-id=0%3A1)

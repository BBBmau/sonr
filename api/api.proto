syntax = "proto3";

import "data.proto";
import "user.proto";

// Require Go Package
option go_package = "/models";

// Client Network Connection Status
enum Connectivity {
  None = 0;
  Mobile = 1;
  WiFi = 2;
}

// Status is User Node Situation
enum Status {
  NONE = 0;         // Default Status on Launch
  CONNECTED = 1;    // Status after starting Host
  BOOTSTRAPPED = 2; // After Bootstrapping Host
  AVAILABLE = 3;    // Connected and Visible on Local Lobby
  SEARCHING = 4;    // File has been Processed ready to Invite
  PENDING = 5;      // Awaiting Peer Authorization
  INVITED = 6;      // Has received Invitation
  INPROGRESS = 7;   // In Middle of Transfer
  STANDBY = 8;      // Away from Sonr Application
}

// Message for Status Update
message StatusUpdate { Status value = 1; }

// Initial Connection Message to Establish Sonr
message ConnectionRequest {
  double latitude = 1;           // Geolocation for OLC
  double longitude = 2;          // Geolocation for OLC
  string username = 3;           // General Peer Info
  Device device = 4;             // Users Device
  Directories directories = 5;   // Users Available File Paths
  Contact contact = 6;           // Users Contact Card
  User user = 7;                 // User Saved Data
  Connectivity connectivity = 8; // Client Network Type
}

// Updated Peer Info Request
message UpdateRequest {
  Type type = 1;                  // Type of Update
  double facing = 2;              // Compass Direction on Z axis
  double heading = 3;             // Compass Direction on Y axis
  Peer.Properties properties = 4; // Updated Peer Properties
  Contact contact = 5;            // Users Updated Contact Card
  Position.Gyroscope gyroscope = 6;
  Position.Accelerometer accelerometer = 7;

  enum Type {
    Direction = 0;
    Contact = 1;
    Properties = 2;
  }
}

// Message to Peer Request
message MessageRequest {
  Peer to = 1;        // Recipient
  string message = 2; // Message Content
  string topic = 3;   // Topic Name
}

// Processes Given File and Invites Specified Peer
message InviteRequest {
  // Properties
  TransferType type = 1; // General Payload Type
  Peer to = 2;           // User thats being Invited
  bool isRemote = 3;     // If Transfer is Remote
  RemoteInfo remote = 4; // Remote Topic Name

  // Attached Data
  string url = 5;              // URL to be Sent - Optional
  Contact contact = 6;         // Contact Card to be Sent - Optional
  repeated Metadata files = 7; // Files to be Sent - Optional

  // Enum for Type of Transfer
  enum TransferType {
    Unknown = 0;     // Default Value, Would not Transfer
    File = 1;        // Media or Document
    MultiFiles = 2;  // Multiple Media or Documents
    Contact = 3;     // Users Contact Card
    URL = 4;         // Website URL Link
    FlatContact = 5; // Send File as Flat Exchange Automatically Swaps
  }
}

message RespondRequest {
  bool decision = 1;     // User Decision
  bool isRemote = 2;     // If Transfer is Remote
  RemoteInfo remote = 3; // Remote Topic Name
}

// Invitation Message sent on RPC
message AuthInvite {
  Payload payload = 1;   // Type of Transfer
  Peer from = 2;         // Users Peer Data
  TransferCard card = 3; // Card contains all Data Info, Transfer Info
  bool isFlat = 4;
  RemoteInfo remote = 5;
}

// Reply Message sent on RPC
message AuthReply {
  Type type = 1;         // Type of Transfer Reply
  Peer from = 2;         // Users Peer Data
  bool decision = 3;     // Users Decision for the Invitation
  TransferCard card = 4; // Card contains all Data Info, Transfer Info
  RemoteInfo remote = 5;

  enum Type {
    None = 0;
    Transfer = 1;
    Contact = 2;
    FlatContact = 3;
    Cancel = 4;
  }
}

// Error Message returned from Core Library
message ErrorMessage {
  string message = 1; // Generated Error Message
  string method = 2;  // Method Error Occurred
}
